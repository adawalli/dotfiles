{{ template "sh_header" . }}

{{- if and (eq .chezmoi.os "linux") (not (env "CHEZMOI_NO_CHSH")) -}}
if ! command -v fish >/dev/null 2>&1; then
  exit 0
fi

current_shell=$(getent passwd "$USER" | cut -d: -f7 || echo "")
fish_path=$(command -v fish)

if [[ "$current_shell" != "$fish_path" ]]; then
  if grep -qx "$fish_path" /etc/shells 2>/dev/null; then
    chsh -s "$fish_path" "$USER" || true
  else
    echo "$fish_path" | sudo tee -a /etc/shells >/dev/null || true
    chsh -s "$fish_path" "$USER" || true
  fi
fi
{{- end }}

exit 0
